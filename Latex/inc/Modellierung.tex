\chapter{Modellbildung und Regelung}

\section{Model}
Für die Modellbildung wird der dreidimensionale Ballbot in drei unabhängige planare Modelle aufgeteilt. In jeder Ebene wird das System vereinfacht als Zusammensetzung von drei starren Körpern bestehend aus einer Kugel, ein virtuelles Rad und einen Körper betrachtet und besitzt somit zwei Freiheitsgrade, die sich in eine Translation bzw. Rotation des Balles und eine Rotation des Körpers aufteilen lassen[ETHZ].\newline
Um ein möglichst vereinfachte Modelle der drei Ebenen zu erhalten, werden weitere Annahmen getroffen, die im Folgenden erläutert werden: 
\begin{itemize}
	\item Kein Schlupf: Das System besitzt zwei Kontaktpunkte, in denen ein Schlupf auftreten kann. Hierzu zählt zum einen der Kontaktpunkt von Ball und Boden und zum zweiten der Kontaktpunkt zwischen den Rädern und dem Ball. Damit dies gewährleistet wird, müssen die angelegten Drehmomente begrenzt werden.
	\item Keine Reibung: Der einzige Vorgang im System, bei dem die Reibung nicht vernachlässigt wird, ist bei der Rotation des Balles um die $z$-Achse. Bei den anderen Vorgängen, bei der in der Realität auch Reibung auftritt, wird im Modell vernachlässigt.
	\item Keine Deformation: Bei dem eingesetzten Ball handelt es sich nicht um eine hohle Stahlkugel, sondern um ein elastischen, mit Luft befüllbaren Ball. Deshalb wird die Deformation des Balles in der Modellbeschreibung nicht mit einbezogen, um die Komplexität gering zu halten. 
	\item Schnelle Motorendynamik: Für die Gleichgewichtsstabilisierung des Roboters ist es wichtig, dass die Motoren eine schneller Dynamik als das System aufweisen. 
	\item Horizontale Bewegung: Das System wird für die horizontale Bewegung auf einer flachen Oberfläche ohne starken Neigungen ausgelegt. Somit wird die vertikale Bewegung vernachlässigt. 
\end{itemize}
Mit den getroffenen Annahmen ist es möglich, das Modell des Ballbots aufzustellen. 

\section{Energien}
Für das Aufstellen der Bewegungsgleichungen des Systems wird der Lagrange Ansatz angewendet. Dazu müssen im Voraus die potentiellen und kinetischen Energien der einzelnen Körper aufgestellt werden. Dabei ist darauf zu achten,dass die Formeln der potentiellen und kinetischen Energien für die $yz$- und der $xz$-Ebene identisch sind und dagegen sich sie die Energie $xy$-Ebene unterscheiden. Deshalb werden im Folgenden die Formeln der $yz$ und $xy$-Ebenen angegeben.\newline
Zunächst werden die kinetischen und potentiellen Energien des Balles in den entsprechenden Ebenen betrachten. 
Für die kinetische Energie werden folgenden Formeln der jeweiligen Ebenen angegeben.
\begin{equation}
	T_{S,yz} = \frac{1}{2} \cdot m_{S} \cdot (r_{S} \cdot \dot \varphi_{x})^2 + \frac{1}{2} \cdot I_{S} \cdot \dot\varphi_{x}^2
\end{equation}
\begin{equation}
	T_{S,xy} =\frac{1}{2} \cdot I_{S} \cdot \dot\varphi_{z}^2
\end{equation}
Da der Ursprung des Weltkoordinatensystems in den Mittelpunkt des Balles gelegt wird, besitzt das System sowohl in der $yz$ als auch in der $yx$ Ebene keine potentielle Energie. 
\begin{equation}
	V_{S,yz}=0
\end{equation}

Die kinetischen Energien des virtuellen Rades der jeweiligen Ebene werden mit den folgenden Formeln angegeben.
\begin{equation}
	T_{W,yz} = \frac{1}{2} \cdot m_{W} \cdot ((r_{S} \cdot \dot \varphi_{x})^2 + 2 \cdot (r_{S}+r_{W}) \cdot \cos(\vartheta_{x})\cdot \dot \vartheta_{x} \cdot (r_{S}\cdot\dot\varphi_{x})+(r_{S} + r_{W})^2\cdot\dot\vartheta_{x}^2) + \frac{1}{2} \cdot I_{W}\cdot(\frac{r_{S}}{r_{W}}\cdot(\dot\varphi_{x}-\dot\vartheta_{x})-\dot\vartheta_{x})^2
\end{equation}
\begin{equation}
	T_{W,xy} =\frac{1}{2} \cdot I_{W} \cdot \dot\Psi_{z}^2
\end{equation}

Die potentielle Energie des virtuellen Rades in der $yz$ Ebene kann folgendermaßen berechnet werden.
\begin{equation}
V_{W,yz} = m_{W} \cdot g \cdot (r_{S} + r_{W})\cdot \cos(\vartheta_{x})
\end{equation}

Die kinetischen Energien für die $yz$ und der $xy$ Ebene für den Roboterkörper sind ähnlich der des virtuellen Rades und werden folgendermaßen berechnet. 
\begin{equation}
T_{B,yz} = \frac{1}{2} \cdot m_{A} \cdot ((r_{S} \cdot \dot \varphi_{x})^2 + 2 \cdot l \cdot \cos(\vartheta_{x})\cdot \dot \vartheta_{x} \cdot (r_{S}\cdot\dot\varphi_{x}) + l^2\cdot\dot\vartheta_{x}^2)+\frac{1}{2} \cdot I_{A}\cdot\dot\vartheta_{x}^2
\end{equation}
\begin{equation}
	T_{B,xy} =\frac{1}{2} \cdot I_{W,xy} \cdot \dot\Psi_{z}^2
\end{equation}

Auch die dazugehörige potentielle Energie ähnelt der des virtuellen Rades. Der Unterschied liegt zum einem im Gewicht des Körpers $m_{B}$ und der Höhe $l$ von Ballmittelpunkt zum Schwerpunkt des Roboteraufbaus.
\begin{equation}
V_{B,yz} = m_{A} \cdot g \cdot l \cdot \cos(\vartheta_{x})
\end{equation}

\section{Bewegungsgleichungen}(matlab)
Mit den kinetischen und potentiellen Energien können nun die Bewegungsgleichungen des Ballbots für die jeweiligen Ebenen mit Hilfe der LAGRANGEschen Gleichungen zweiter Art hergeleitet werden. Als Beispiel wird hier die Herleitung für die $yz$-Ebene angegeben.\newline
Zunächst wird aus den einzelnen Summen der kinetischen und potentiellen Energien die LANGRANGEsche Funktion gebildet. 	
\begin{equation}
		L = T - V 
\end{equation}
Die Bewegungsgleichungen für den Ballbot resultieren aus dem Lösen der LAGRANGEschen Gleichungen zweiter Art. 
	\begin{equation}
		\frac{d}{dt}(\frac{\partial L}{\partial \dot{\mathbf{q}}^{2}}) - \frac{\partial L}{\partial \mathbf{q}} = \mathbf{f}_{NP,yz}
\end{equation}

Mit mathematische Umformungen können diese Bewegungsgleichungen in eine Matrixform überführt werden. 
\begin{eqnarray}
\label{eq:MatrizenDGL}
\mathbf{M}_{x}=\begin{bmatrix} m_{tot} \cdot r_{S}^{2} + I_{S} + (\frac{r_{S}}{r_{W}})^{2} \cdot I_{W}  & -\frac{r_{S}}{r_{W}^2}\cdot r_{tot} \cdot I_{W} + \gamma \cdot r_{S} \cdot \cos{\vartheta_{x}} m_{tot} \\ -\frac{r_{S}}{r_{W}^2}\cdot r_{tot} \cdot I_{W} + \gamma \cdot r_{S} \cdot \cos{\vartheta_{x}} m_{tot}	& \frac{r_{S}^2}{r_{W}^2} \cdot I_{W} + I_{B} + m_{b}\cdot l^2 + m_{W}\cdot r_{tot}^2  \\ \end{bmatrix} &,& \mathbf{M}_{x} \in \mathbb{R}\textsuperscript{2$\times$2} \nonumber \\ 
\mathbf{C}_{x} =\begin{bmatrix}  -r_{S} \cdot \gamma \cdot \sin{\vartheta_{x}} \cdot \dot \vartheta_{x}^{2} \\ 0 \\ \end{bmatrix} &,& \mathbf{C}_{x} \in \mathbb{R}\textsuperscript{\textit{2$\times$1}} \nonumber \\
\mathbf{G}_{x}=\begin{bmatrix}  0 \\ -g\cdot \sin{\theta_{x}}\cdot \gamma  \\ \end{bmatrix}  &,&  \mathbf{G}_{x} \in \mathbb{R}\textsuperscript{\textit{2$\times$1}} \nonumber \\ 
\end{eqnarray}
	

\section{Zustandsraumdarstellung}
Bei den hergeleiteten Bewegungsgleichungen handelt es sich um nichtlineare Funktionen. Um ein Zustandsraummodell zu erhalten, müssen zunächst die Zustände bzw. der Zustandsvektor festgelegt werden. Als Beispiel wird auch hier die $yz$-Ebene betrachtet. Mit $\mathbf{x} = [\varphi_{x}, \vartheta_{x}, \dot\varphi_{x}, \dot\vartheta_{x}]$ können die nichtlinearen Funktionen in folgende Form überführt werden.
\begin{equation}
\dot{\mathbf{x}} = \begin{bmatrix} \mathbf{q}\\ \dot{\mathbf{q}}\\ \end{bmatrix} = \begin{bmatrix} \dot{\mathbf{q}}\\  \mathbf{M_{x}}^{-1}\cdot (\mathbf{f}_{NP}-(\mathbf{C_{x}}+\mathbf{G_{x}}))\\ \end{bmatrix}
\end{equation}

Das Ziel dieser Arbeit ist das Auslegen eines Reglers, damit der Roboter innerhalb eines kleinen Bereiches um den Arbeitspunkt $\mathbf{x}_{0}= [0, 0, 0, 0]$ auf dem einen Ball balanciert. Hierzu muss zunächst das nichtlineare Modell um den Arbeitspunkt mit der Taylor-Reihenentwicklung linearisiert werden, um die lineare Zustandsraumdarstellung 
\begin{eqnarray}
\label{eq:LZRD}
\dot{\mathbf{x}}=\mathbf{A}\cdot\mathbf{x} + \mathbf{B} \cdot \mathbf{u} \nonumber \\
\label{eq:LZRD1}
\mathbf{y}=\mathbf{C} \cdot \mathbf{x} + \mathbf{D} \cdot \mathbf{u} 
\end{eqnarray}
zu erhalten. Mit den zum Roboter dazugehörigen Parametern und dem eingesetzten Arbeitspunkt lauten die konkreten Matrizen für die Zustandsraumdarstellung der $yz$-Ebene folgender Maßen:

\begin{align}
\label{eq:konkZRD}
\mathbf{A}=\begin{bmatrix} 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \\ 0 & 0.4886 & 0 & 0 \\ 0 & 17.1119 & 0 & 0\end{bmatrix} & 
\mathbf{B}=\begin{bmatrix} 0 \\ 0 \\ 63.5516 \\ -10.6945 \end{bmatrix} &
\mathbf{C}=\begin{bmatrix} 1 & 0 & 0 & 0 \\ 0 & 1 & 0 & 0 \\ 0 & 0 & 1 & 0\\ 0 & 0 & 0 & 1 \end{bmatrix} &
\mathbf{D}=\begin{bmatrix} 0 \\ 0 \\ 0\\ 0 \end{bmatrix} \nonumber 
\end{align} 

Damit der Roboter auf einen Ball die eigene Gleichgewichtslage einhalten kann, ist es zunächst nebensächlich, welche Position und Geschwindigkeit der Ball dabei einnimmt, da in dem linearisierten Modell nur geringe Abweichungen um die Ruhelage zulässig sind. Dadurch sind für den späteren Entwurf einer Regelung die Zustände des Roboters von Bedeutung und die Zustände für den Ball müssen nicht für eine Regelung berücksichtigt werden. Mit dem neuem Zustandsvektor ... wird die Ordnung des Modells \ref{eq:LZRD} reduziert, das zu folgenden Zustandsraummatrizen führt: 


\begin{align}
%\label{eq:redZRD}
\mathbf{A}^{*}=\begin{bmatrix} 0 & 1 \\ 17.1119 & 0 \end{bmatrix} & 
\mathbf{B}^{*}=\begin{bmatrix} 0 \\ -10.6945 \end{bmatrix} &
\mathbf{C}^{*}=\begin{bmatrix} 1 & 0 \\ 0 & 1 \end{bmatrix} &
\mathbf{D}^{*}=\begin{bmatrix} 0 \\ 0 \end{bmatrix} \nonumber 
\end{align}

Die Prüfung auf Stabilität der beiden Modellen erfolgt anhand der Lage der Eigenwerte. Das ursprüngliche als auch das reduzierte Modell besitzt folgende Eigenwerte: 

\begin{align}
%\label{eq:EW}
\mathbf{\lambda}=\begin{pmatrix} 0 \\ 0 \\  4.1367\\ -4.1367 \end{pmatrix} & 
\mathbf{\lambda}^{*}=\begin{pmatrix} 4.1367 \\ -4.1367 \end{pmatrix} & 
\end{align}

Das ursprünglich Modell besitzt zwei grenzstabilen Eigenwerte $\lambda_{1,2} = 0$ auf der Imaginären Achse und einen instabilen Eigenwert $\lambda_{3} = 4.1367$ in der rechten Halbebene des Bildbereiches. Somit ist das System instabil. Bei dem reduzierten Modell handelt es sich ebenfalls um ein instabiles System, da es auch einen Eigenwerte $\lambda_{1}^{*} = 4.1367$ besitzt.\newline
Die Untersuchung der Steuer- und Beobachtbarkeit erfolgt in beiden Modelle mit den entsprechenden Kriterien von KALMANN. In beiden Fällen besitzen die Steuerbarkeits- und Beobachtbarkeitsmatrizen vollen Rang, wodurch beide Modelle vollständig steuer- und beobachtbar sind. Mit diesen Systemeigenschaften ist mit Hilfe eines Reglers möglich, die entsprechende instabile System zu stabilisieren. Das Auslegen eines geeigneten Regler wird nachfolgend erläutert. [ETHZ,MGR]   
  
\section{Reglerentwurf}
Der Entwurf eines geeigneten Regler zur Stabilisierung der Gleichgewichtslage des Roboters wird im Folgenden auf das reduzierte Model beschränkt. Für die beiden Modelle der $yz$- und $xz$-Ebene wird jeweils eine Linear-quadratische Regelung (LQR) ausgelegt, die auf die Minimierung des Gütemaß
\begin{equation}
	J = \int_{0}^{\infty} \mathbf{x}^{T}(t)\cdot \mathbf{Q} \cdot \mathbf{x}(t) + \mathbf{u}^{T}(t)\cdot \mathbf{R} \cdot \mathbf{u}(t)
\end{equation}
durch einen vorgegebenen Stellgrößenverlauf basiert. In das Güteintegral geht quadratisch zum einen der Trajektorienverlauf $\mathbf{x}(t)$ und der Stellgrößenverlauf $\mathbf{u}(t)$ ein. Dabei handelt es sich bei der symmetrischen und positiv semidefiniten Matrix $\mathbf{Q}$ um eine Gewichtungsmatrix für den Trajektorienverlauf. Die symmetrische und positiv definite Matrix $\mathbf{R}$ gewichtet die Stellgröße.[AD]   

  
